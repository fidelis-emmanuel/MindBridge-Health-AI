<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MindBridge Mentor ‚Äî Simulation Lab</title>
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --card: #22263a;
    --border: #2e3350;
    --accent: #4f8ef7;
    --green: #22c55e;
    --yellow: #f59e0b;
    --red: #ef4444;
    --purple: #a855f7;
    --text: #e2e8f0;
    --muted: #64748b;
    --sim-color: #f59e0b;
    --int-color: #a855f7;
    --con-color: #4f8ef7;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', system-ui, sans-serif;
    min-height: 100vh;
  }

  /* Header */
  .header {
    background: linear-gradient(135deg, #1a1d27 0%, #0f1117 100%);
    border-bottom: 1px solid var(--border);
    padding: 20px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .header-left h1 { font-size: 20px; font-weight: 700; color: var(--text); }
  .header-left p { font-size: 13px; color: var(--muted); margin-top: 2px; }
  .target-badge {
    background: linear-gradient(135deg, #22c55e20, #22c55e10);
    border: 1px solid #22c55e40;
    border-radius: 20px;
    padding: 6px 16px;
    font-size: 13px;
    color: var(--green);
    font-weight: 600;
  }

  /* Layout */
  .container { display: flex; height: calc(100vh - 73px); }

  /* Sidebar */
  .sidebar {
    width: 280px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    flex-shrink: 0;
  }
  .sidebar-section { padding: 16px; border-bottom: 1px solid var(--border); }
  .sidebar-title {
    font-size: 11px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 12px;
  }
  .scenario-btn {
    width: 100%;
    text-align: left;
    background: none;
    border: 1px solid transparent;
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--text);
    cursor: pointer;
    margin-bottom: 4px;
    transition: all 0.15s;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }
  .scenario-btn:hover { background: var(--card); border-color: var(--border); }
  .scenario-btn.active { background: var(--card); border-color: var(--accent); }
  .scenario-btn .icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
  .scenario-btn .info { flex: 1; }
  .scenario-btn .name { font-size: 13px; font-weight: 600; line-height: 1.3; }
  .scenario-btn .tag {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    margin-top: 3px;
    letter-spacing: 0.06em;
  }
  .tag-sim { color: var(--sim-color); }
  .tag-int { color: var(--int-color); }
  .tag-con { color: var(--con-color); }

  /* Main area */
  .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

  /* Simulation stage */
  .stage {
    flex: 1;
    padding: 32px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Scenario card */
  .scenario-header {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
  }
  .scenario-type {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 4px 10px;
    border-radius: 20px;
    margin-bottom: 14px;
  }
  .type-sim { background: #f59e0b20; color: var(--sim-color); border: 1px solid #f59e0b40; }
  .type-int { background: #a855f720; color: var(--int-color); border: 1px solid #a855f740; }
  .type-con { background: #4f8ef720; color: var(--con-color); border: 1px solid #4f8ef740; }
  .scenario-question {
    font-size: 17px;
    font-weight: 600;
    line-height: 1.5;
    color: var(--text);
  }
  .scenario-context {
    margin-top: 12px;
    font-size: 13px;
    color: var(--muted);
    line-height: 1.6;
    padding: 12px;
    background: #ffffff08;
    border-radius: 8px;
    border-left: 3px solid var(--accent);
  }

  /* Answer area */
  .answer-section { display: flex; flex-direction: column; gap: 12px; }
  .answer-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .answer-textarea {
    width: 100%;
    min-height: 140px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    color: var(--text);
    font-size: 14px;
    font-family: inherit;
    line-height: 1.6;
    resize: vertical;
    transition: border-color 0.15s;
    outline: none;
  }
  .answer-textarea:focus { border-color: var(--accent); }
  .answer-textarea::placeholder { color: var(--muted); }

  /* Buttons */
  .btn-row { display: flex; gap: 10px; align-items: center; }
  .btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: #3b7ce8; }
  .btn-secondary {
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
  }
  .btn-secondary:hover { border-color: var(--accent); }
  .btn-disabled { opacity: 0.5; cursor: not-allowed; }

  /* Ideal answer reveal */
  .ideal-answer {
    background: var(--card);
    border: 1px solid #22c55e40;
    border-radius: 12px;
    padding: 20px;
    display: none;
  }
  .ideal-answer.show { display: block; }
  .ideal-title {
    font-size: 12px;
    font-weight: 700;
    color: var(--green);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .ideal-text {
    font-size: 14px;
    line-height: 1.7;
    color: var(--text);
  }
  .ideal-text strong { color: var(--accent); }

  /* Rating */
  .rating-section {
    display: none;
    flex-direction: column;
    gap: 12px;
  }
  .rating-section.show { display: flex; }
  .rating-label {
    font-size: 13px;
    color: var(--muted);
    font-weight: 600;
  }
  .rating-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
  .rating-btn {
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text);
    transition: all 0.15s;
  }
  .rating-btn:hover { transform: translateY(-1px); }
  .rating-btn[data-r="1"]:hover { background: #ef444420; border-color: var(--red); color: var(--red); }
  .rating-btn[data-r="2"]:hover { background: #f59e0b20; border-color: var(--yellow); color: var(--yellow); }
  .rating-btn[data-r="3"]:hover { background: #22c55e20; border-color: var(--green); color: var(--green); }
  .rating-btn[data-r="4"]:hover { background: #4f8ef720; border-color: var(--accent); color: var(--accent); }

  /* Feedback panel */
  .feedback-panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    display: none;
  }
  .feedback-panel.show { display: block; }
  .feedback-title {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .feedback-text { font-size: 13px; line-height: 1.7; color: var(--text); }
  .feedback-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 12px; }
  .feedback-tag {
    font-size: 11px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 12px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Stats bar */
  .stats-bar {
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 12px 32px;
    display: flex;
    gap: 32px;
    align-items: center;
  }
  .stat { display: flex; align-items: center; gap: 8px; }
  .stat-value { font-size: 18px; font-weight: 700; color: var(--text); }
  .stat-label { font-size: 12px; color: var(--muted); }
  .stat-divider { width: 1px; height: 28px; background: var(--border); }

  /* Welcome screen */
  .welcome {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px;
    gap: 16px;
  }
  .welcome h2 { font-size: 24px; font-weight: 700; }
  .welcome p { font-size: 15px; color: var(--muted); max-width: 420px; line-height: 1.6; }
  .welcome-cards { display: flex; gap: 16px; margin-top: 8px; }
  .welcome-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    width: 160px;
    text-align: center;
  }
  .welcome-card .icon { font-size: 28px; margin-bottom: 8px; }
  .welcome-card .title { font-size: 13px; font-weight: 700; margin-bottom: 4px; }
  .welcome-card .desc { font-size: 11px; color: var(--muted); line-height: 1.5; }

  /* Loading */
  .loading {
    display: none;
    align-items: center;
    gap: 8px;
    color: var(--muted);
    font-size: 13px;
  }
  .loading.show { display: flex; }
  .spinner {
    width: 16px; height: 16px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <h1>üè• MindBridge Mentor ‚Äî Simulation Lab</h1>
    <p>Interactive scenario practice for Healthcare AI Engineer interviews</p>
  </div>
  <div class="target-badge">üéØ Target: $200K‚Äì$300K</div>
</div>

<div class="container">

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">üé≠ Simulations (6)</div>
      <button class="scenario-btn" onclick="loadScenario('login')" id="btn-login">
        <span class="icon">üîê</span>
        <span class="info">
          <div class="name">Patient Login Flow</div>
          <div class="tag tag-sim">Simulation</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('screening')" id="btn-screening">
        <span class="icon">‚öïÔ∏è</span>
        <span class="info">
          <div class="name">Risk Screening Pipeline</div>
          <div class="tag tag-sim">Simulation</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('apikey')" id="btn-apikey">
        <span class="icon">üîë</span>
        <span class="info">
          <div class="name">Junior Dev: API Keys</div>
          <div class="tag tag-sim">Simulation</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('debug500')" id="btn-debug500">
        <span class="icon">üêõ</span>
        <span class="info">
          <div class="name">Debug 500 Error</div>
          <div class="tag tag-sim">Simulation</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('slowapi')" id="btn-slowapi">
        <span class="icon">üêå</span>
        <span class="info">
          <div class="name">API Performance Issue</div>
          <div class="tag tag-sim">Simulation</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('corserror')" id="btn-corserror">
        <span class="icon">üö´</span>
        <span class="info">
          <div class="name">CORS Error</div>
          <div class="tag tag-sim">Simulation</div>
        </span>
      </button>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">üé§ Interview Practice (6)</div>
      <button class="scenario-btn" onclick="loadScenario('whyhire')" id="btn-whyhire">
        <span class="icon">üíº</span>
        <span class="info">
          <div class="name">Why Hire You?</div>
          <div class="tag tag-int">Interview</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('project')" id="btn-project">
        <span class="icon">üöÄ</span>
        <span class="info">
          <div class="name">Tell Me About a Project</div>
          <div class="tag tag-int">Interview</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('apidesign')" id="btn-apidesign">
        <span class="icon">üèóÔ∏è</span>
        <span class="info">
          <div class="name">API Design Process</div>
          <div class="tag tag-int">Interview</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('sensitive')" id="btn-sensitive">
        <span class="icon">üîí</span>
        <span class="info">
          <div class="name">Handling Sensitive Data</div>
          <div class="tag tag-int">Interview</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('testing')" id="btn-testing">
        <span class="icon">üß™</span>
        <span class="info">
          <div class="name">Testing Strategy</div>
          <div class="tag tag-int">Interview</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('bulkimport')" id="btn-bulkimport">
        <span class="icon">üì§</span>
        <span class="info">
          <div class="name">Bulk CSV Import Design</div>
          <div class="tag tag-int">Interview</div>
        </span>
      </button>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">üí° Concept Check (4)</div>
      <button class="scenario-btn" onclick="loadScenario('docker')" id="btn-docker">
        <span class="icon">üê≥</span>
        <span class="info">
          <div class="name">Docker & Containers</div>
          <div class="tag tag-con">Concept</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('postgres')" id="btn-postgres">
        <span class="icon">üóÑÔ∏è</span>
        <span class="info">
          <div class="name">PostgreSQL vs MongoDB</div>
          <div class="tag tag-con">Concept</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('hipaa')" id="btn-hipaa">
        <span class="icon">üè•</span>
        <span class="info">
          <div class="name">HIPAA Requirements</div>
          <div class="tag tag-con">Concept</div>
        </span>
      </button>
      <button class="scenario-btn" onclick="loadScenario('pooling')" id="btn-pooling">
        <span class="icon">üîÑ</span>
        <span class="info">
          <div class="name">Connection Pooling</div>
          <div class="tag tag-con">Concept</div>
        </span>
      </button>
    </div>
  </div>

  <!-- Main Stage -->
  <div class="main">
    <div class="stage" id="stage">

      <!-- Welcome screen shown by default -->
      <div class="welcome" id="welcome">
        <div style="font-size:48px">üè•</div>
        <h2>Welcome to Simulation Lab</h2>
        <p>Practice real scenarios you'll face in Healthcare AI Engineer interviews. 16 scenarios covering simulations, interviews, and technical concepts.</p>
        <div class="welcome-cards">
          <div class="welcome-card">
            <div class="icon">üé≠</div>
            <div class="title">Simulations</div>
            <div class="desc">6 real-world system scenarios including Docker and debugging</div>
          </div>
          <div class="welcome-card">
            <div class="icon">üé§</div>
            <div class="title">Interview</div>
            <div class="desc">6 interview scenarios including testing and system design</div>
          </div>
          <div class="welcome-card">
            <div class="icon">üí°</div>
            <div class="title">Concepts</div>
            <div class="desc">4 deep-dive technical concepts: Docker, PostgreSQL, HIPAA, Pooling</div>
          </div>
        </div>
      </div>

      <!-- Scenario content (hidden until selected) -->
      <div id="scenario-content" style="display:none;">

        <div class="scenario-header">
          <div class="scenario-type" id="scenario-type-badge"></div>
          <div class="scenario-question" id="scenario-question"></div>
          <div class="scenario-context" id="scenario-context" style="display:none"></div>
        </div>

        <div class="answer-section">
          <div class="answer-label">Your Answer</div>
          <textarea
            class="answer-textarea"
            id="user-answer"
            placeholder="Type your answer here... Try to recall everything before revealing the ideal answer."
          ></textarea>
          <div class="btn-row">
            <button class="btn btn-primary" id="reveal-btn" onclick="revealAnswer()">
              Reveal Ideal Answer
            </button>
            <div class="loading" id="loading-indicator">
              <div class="spinner"></div>
              <span>Analyzing your answer...</span>
            </div>
          </div>
        </div>

        <div class="ideal-answer" id="ideal-answer">
          <div class="ideal-title">‚úÖ Ideal Answer</div>
          <div class="ideal-text" id="ideal-text"></div>
        </div>

        <div class="rating-section" id="rating-section">
          <div class="rating-label">How well did you know this?</div>
          <div class="rating-buttons">
            <button class="rating-btn" data-r="1" onclick="rateAnswer(1)">‚ùå No idea</button>
            <button class="rating-btn" data-r="2" onclick="rateAnswer(2)">üòì Partial</button>
            <button class="rating-btn" data-r="3" onclick="rateAnswer(3)">‚úì Good</button>
            <button class="rating-btn" data-r="4" onclick="rateAnswer(4)">‚≠ê Perfect</button>
          </div>
        </div>

        <div class="feedback-panel" id="feedback-panel">
          <div class="feedback-title" id="feedback-title"></div>
          <div class="feedback-text" id="feedback-text"></div>
          <div class="feedback-tags" id="feedback-tags"></div>
          <div style="margin-top:16px">
            <button class="btn btn-secondary" onclick="nextScenario()">Next Scenario ‚Üí</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Stats bar -->
    <div class="stats-bar">
      <div class="stat">
        <div class="stat-value" id="stat-completed">0</div>
        <div class="stat-label">Completed Today</div>
      </div>
      <div class="stat-divider"></div>
      <div class="stat">
        <div class="stat-value" id="stat-score">‚Äî</div>
        <div class="stat-label">Avg Rating</div>
      </div>
      <div class="stat-divider"></div>
      <div class="stat">
        <div class="stat-value" style="color:var(--green)">Week 2</div>
        <div class="stat-label">Curriculum Phase</div>
      </div>
      <div class="stat-divider"></div>
      <div class="stat">
        <div class="stat-value" style="color:var(--accent)">16</div>
        <div class="stat-label">Total Scenarios</div>
      </div>
      <div class="stat-divider"></div>
      <div class="stat">
        <div class="stat-value" style="color:var(--green)">$200K+</div>
        <div class="stat-label">Target Role</div>
      </div>
    </div>
  </div>
</div>

<script>
const scenarios = {
  login: {
    type: "simulation",
    title: "Patient Login Flow Simulation",
    question: "You're a case manager at Oakwood Behavioral Health. Walk me through exactly what happens ‚Äî technically ‚Äî when you log into MindBridge. What systems are involved at each step?",
    context: "Scenario context: You're explaining this to a new developer joining the team. Be specific about each system, security measure, and what data flows where.",
    ideal: `<strong>Step 1 ‚Äî Browser to Frontend:</strong> You enter your email + password on the Next.js login page. The form submits to NextAuth.js, which handles the session layer.<br><br>
<strong>Step 2 ‚Äî Frontend to Backend:</strong> NextAuth sends credentials to FastAPI POST /api/auth/verify with email and password hash.<br><br>
<strong>Step 3 ‚Äî Database Validation:</strong> FastAPI queries PostgreSQL ‚Äî SELECT user WHERE email matches, then bcrypt.verify() checks the password hash. Plain passwords are NEVER stored.<br><br>
<strong>Step 4 ‚Äî MFA Check:</strong> If the user has MFA enabled (required for admin roles), FastAPI prompts for TOTP code before proceeding.<br><br>
<strong>Step 5 ‚Äî JWT Issued:</strong> FastAPI generates a signed JWT token containing user_id, role, clinic_id, and expiry. Signed with RS256 ‚Äî can't be forged.<br><br>
<strong>Step 6 ‚Äî Secure Cookie:</strong> NextAuth stores the session in an httpOnly, Secure cookie. JavaScript cannot read this cookie ‚Äî XSS-proof.<br><br>
<strong>Step 7 ‚Äî Scoped Dashboard:</strong> Dashboard loads ‚Äî every API call includes the Bearer token. FastAPI validates it and queries ONLY patients WHERE case_manager_id = your user_id.<br><br>
<strong>Step 8 ‚Äî HIPAA Audit:</strong> Every login is logged to audit_log table: user_id, timestamp, IP address, action='LOGIN'. This is required by HIPAA.`
  },

  screening: {
    type: "simulation",
    title: "Risk Screening Pipeline",
    question: "A case manager clicks 'Screen Patient' for Marcus Johnson (patient_id: uuid-123). Walk through the complete technical pipeline from button click to risk badge appearing on the dashboard.",
    context: "This is a common system design question. Show you understand async flows, AI integration, error handling, and HIPAA compliance.",
    ideal: `<strong>1. Frontend Request:</strong> Next.js sends POST /api/analysis { patient_id: 'uuid-123' } with Bearer JWT token in headers.<br><br>
<strong>2. Middleware Layer:</strong> FastAPI validates JWT (user authenticated), checks RBAC (has 'analyst' role), applies rate limiting (prevents abuse).<br><br>
<strong>3. Patient Fetch:</strong> Analysis Service queries PostgreSQL: SELECT * FROM patients WHERE id='uuid-123' AND deleted_at IS NULL. Confirms patient belongs to this case manager's clinic.<br><br>
<strong>4. Claude API Call:</strong> Structured prompt sent to Claude with patient data: appointments_missed, medication_adherence, crisis_calls_30days, diagnosis. Async ‚Äî doesn't block other requests.<br><br>
<strong>5. AI Response Parsed:</strong> Claude returns Risk Level, Primary Factor, Recommended Action. Pydantic validates the response structure.<br><br>
<strong>6. Database Write:</strong> ACID transaction: (a) INSERT screening result, (b) UPDATE patient risk_level, (c) INSERT audit_log. All three succeed or NONE do ‚Äî no partial writes.<br><br>
<strong>7. High Risk Alert:</strong> If risk_level = 'HIGH', Notification Service sends email to case manager's supervisor immediately. This is a patient safety feature.<br><br>
<strong>8. Response to Frontend:</strong> FastAPI returns { screening_id, risk_level, primary_factor, action, timestamp }. Next.js updates the dashboard with color-coded risk badge (Red/Orange/Green).`
  },

  apikey: {
    type: "simulation",
    title: "Junior Developer: API Key Security",
    question: "A new junior developer on your team just committed their Anthropic API key directly in the Python code and pushed to GitHub. They say 'it's fine, our repo is private.' How do you respond?",
    context: "This is both a technical and professional situation. Show you understand security, HIPAA implications, and how to mentor without being dismissive.",
    ideal: `<strong>First, act immediately:</strong> "Let's fix this right now before anything else. Private repos get made public, get transferred, get forked. Go to Anthropic's dashboard and revoke that key immediately. Generate a new one."<br><br>
<strong>Then explain why 'private' isn't safe:</strong> "Three reasons this is serious: (1) Git history is permanent ‚Äî even after you delete the file, the key exists in every commit forever. git log shows everything. (2) Private repos get breached ‚Äî GitHub has had security incidents. (3) For a healthcare app, an exposed key means an exposed Claude API ‚Äî that could mean patient data in prompts is accessible."<br><br>
<strong>Show the right way:</strong> "Use os.environ.get('ANTHROPIC_API_KEY'). In development, put it in a .env file that's in .gitignore. In production, use AWS Secrets Manager or environment variables in your deployment platform."<br><br>
<strong>HIPAA angle:</strong> "If this were a production system and patient data was in those API prompts, this could be a HIPAA breach notification situation ‚Äî not just a bug to fix."<br><br>
<strong>Make it a learning moment:</strong> "I'll send you our security checklist. This happens to everyone once ‚Äî the goal is it only happens once."`
  },

  debug500: {
    type: "simulation",
    title: "Debug 500 Error in Production",
    question: "Your FastAPI endpoint suddenly returns 500 Internal Server Error. Users are calling support. Walk me through debugging it step by step.",
    context: "This tests real-world debugging under pressure. Show methodical thinking, not panic.",
    ideal: `<strong>STEP 1 ‚Äî Check the logs immediately:</strong><br>
tail -f logs/app.log or check CloudWatch/Railway logs. The 500 error will have a stack trace showing exactly where it failed.<br><br>
<strong>STEP 2 ‚Äî Identify the error type:</strong><br>
DatabaseError = connection pool exhausted or DB down. Check: docker compose ps or Railway dashboard.<br>
ClientError (Anthropic) = API key invalid or rate limit hit. Check: Anthropic dashboard.<br>
ValidationError = data schema mismatch. Check: Pydantic model definitions.<br>
AttributeError = code trying to access None. Check: null checks before field access.<br><br>
<strong>STEP 3 ‚Äî Common MindBridge 500 causes and fixes:</strong><br>
'Connection pool exhausted' ‚Üí Increase pool_size in SQLAlchemy (default 5 is too low for production).<br>
'anthropic.APIError: Invalid API key' ‚Üí Environment variable not set correctly in production.<br>
'NoneType has no attribute' ‚Üí Database returned null, code didn't check. Fix: Add if patient is not None check.<br><br>
<strong>STEP 4 ‚Äî Reproduce locally:</strong><br>
Copy the exact request from logs, replay in Postman/curl. Fix the bug and deploy.<br><br>
<strong>STEP 5 ‚Äî Add monitoring:</strong><br>
After fixing, add logging around the failure point so next time you catch it earlier.<br><br>
<strong>Interview gold:</strong> "Read the logs first. The stack trace tells you exactly what failed. Most 500 errors are fixed in under 10 minutes if you read the error message carefully instead of guessing."`
  },

  slowapi: {
    type: "simulation",
    title: "API Performance - It's Too Slow",
    question: "A case manager reports the API is 'slow'. The dashboard takes 10 seconds to load. How do you diagnose and fix it?",
    context: "Performance debugging is a core skill. Show you know how to measure before optimizing.",
    ideal: `<strong>STEP 1 ‚Äî Define 'slow':</strong><br>
Get specifics: Which endpoint? How slow (2 seconds? 30 seconds?)? Happens always or intermittently?<br><br>
<strong>STEP 2 ‚Äî Check the obvious:</strong><br>
Is Claude API down? (Check status.anthropic.com)<br>
Is database connection pool exhausted? (Check logs for 'Timeout waiting for connection')<br>
Is the network slow? (Check CloudWatch/Railway metrics)<br><br>
<strong>STEP 3 ‚Äî Add timing logs:</strong><br>
import time; start = time.time(); result = await db.query(...); print(f'Query took {time.time()-start}s')<br>
This shows which part is slow: database? Claude API? Data processing?<br><br>
<strong>STEP 4 ‚Äî Common MindBridge performance issues:</strong><br>
<strong>N+1 queries</strong> ‚Äî Loading 50 patients then fetching each patient's screenings individually. Fix: Use JOIN or eager loading.<br>
<strong>Missing database index</strong> ‚Äî Querying WHERE clinic_id without an index scans entire table. Fix: CREATE INDEX idx_patients_clinic ON patients(clinic_id).<br>
<strong>Large response payloads</strong> ‚Äî Returning 10MB of data when frontend only needs 50KB. Fix: Use Pydantic response model to include only necessary fields.<br>
<strong>Synchronous blocking</strong> ‚Äî Claude API call blocks all other requests. Already fixed with async.<br><br>
<strong>STEP 5 ‚Äî Verify the fix:</strong><br>
Before: Dashboard loads in 10 seconds.<br>
After: Dashboard loads in 0.5 seconds.<br>
Log the improvement. Update monitoring.<br><br>
<strong>Interview gold:</strong> "Performance issues are usually database queries. Add timing, find the slow query, add an index. 90% of the time that's the fix. The other 10% is usually oversized API responses."`
  },

  corserror: {
    type: "simulation",
    title: "CORS Error - Frontend Can't Reach Backend",
    question: "Your Next.js frontend suddenly can't reach the FastAPI backend. Browser console shows: 'CORS policy: No Access-Control-Allow-Origin header'. What do you do?",
    context: "CORS errors confuse many developers. Show you understand web security fundamentals.",
    ideal: `<strong>What CORS is:</strong><br>
CORS (Cross-Origin Resource Sharing) is a browser security feature that blocks requests between different domains by default.<br><br>
<strong>Why it's failing:</strong><br>
Frontend runs on app.mindbridge.com (or localhost:3000 in dev).<br>
Backend runs on api.mindbridge.com (or localhost:8000 in dev).<br>
Browser blocks the request because origins don't match.<br><br>
<strong>THE FIX ‚Äî Add CORS middleware to FastAPI:</strong><br>
from fastapi.middleware.cors import CORSMiddleware<br>
app.add_middleware(CORSMiddleware, allow_origins=["https://app.mindbridge.com"], allow_credentials=True, allow_methods=["GET","POST","PUT","DELETE"], allow_headers=["Authorization","Content-Type"])<br><br>
<strong>Development config:</strong><br>
allow_origins=["http://localhost:3000"] ‚Äî for local Next.js dev server<br><br>
<strong>CRITICAL ‚Äî What NOT to do:</strong><br>
NEVER use allow_origins=["*"] in production for a healthcare app. That means ANY website can call your patient data API. For a HIPAA-compliant system, you must whitelist specific origins.<br><br>
<strong>How to test:</strong><br>
Open browser DevTools ‚Üí Network tab ‚Üí Try the API call ‚Üí Response headers should show Access-Control-Allow-Origin: https://app.mindbridge.com<br><br>
<strong>Interview gold:</strong> "CORS is a browser security feature, not a server problem. The fix is always on the backend ‚Äî add the CORS middleware with explicit origin whitelisting. Never use wildcards in healthcare applications."`
  },

  whyhire: {
    type: "interview",
    title: "Why Should We Hire You?",
    question: "We have several candidates with Computer Science degrees from top universities applying for this Healthcare AI Engineer role. Why should we hire you instead?",
    context: "This is your moment. Use your 10 years of clinical experience as the unfair advantage it is. Don't be defensive ‚Äî be confident.",
    ideal: `"Computer Science degrees teach algorithms, data structures, and systems ‚Äî all valuable. But they don't teach you what happens when a risk assessment algorithm flags the wrong patient, or why a case manager will ignore an alert that fires too often, or what a behavioral health crisis actually looks like at 2 AM.<br><br>
In my 10 years as a Mental Health Technician and CNA, I've lived those scenarios. I've watched high-risk patients fall through the cracks because the documentation system was too slow. I've seen staff ignore automated alerts because the false positive rate was too high. I know exactly the problems that MindBridge Health AI is designed to solve ‚Äî not from reading about them, but from experiencing them.<br><br>
That domain expertise changes how I build systems. When I designed the risk screening algorithm, I didn't just optimize for accuracy ‚Äî I designed the alert thresholds to minimize alert fatigue based on clinical workflows I've actually worked in. I built the audit logging not just for compliance, but because I know auditors show up after incidents, not before.<br><br>
You can teach a CS grad to use FastAPI in 6 months. You cannot teach 10 years of behavioral health experience. I bring both, and that's rare."`
  },

  project: {
    type: "interview",
    title: "Tell Me About a Recent Project",
    question: "Tell me about a technical project you've built recently. Walk me through the problem, your approach, and the outcome.",
    context: "Use the 3-part framework: Clinical Context ‚Üí Technical Solution ‚Üí Business Impact. Always anchor in your healthcare experience.",
    ideal: `<strong>CLINICAL CONTEXT:</strong> "In my 10 years as a Mental Health Technician, I watched case managers spend 6+ hours every day manually reviewing patient charts to assess risk ‚Äî checking medication adherence, counting missed appointments, reviewing crisis call logs. With 30-40 patients per case manager, high-risk patients sometimes fell through the cracks between reviews."<br><br>
<strong>TECHNICAL SOLUTION:</strong> "I built MindBridge Health AI ‚Äî a full-stack, HIPAA-compliant behavioral health risk screening platform. The backend is FastAPI with PostgreSQL, integrated with Claude AI for risk assessment. I built an automated pipeline that ingests patient data from CSV or direct entry, sends each patient through a structured Claude prompt with clinical guardrails, and generates professional reports in Word, Excel, and PDF. The system uses role-based access control and comprehensive audit logging for HIPAA compliance."<br><br>
<strong>BUSINESS IMPACT:</strong> "What used to take a case manager 6+ hours now takes under 2 minutes. The AI correctly identifies high-risk patients with high sensitivity, and the clinical guardrails I built ensure the AI can never automatically downgrade a patient who's been manually escalated ‚Äî a human is always in the loop for that decision. It's the kind of system I wish existed when I was doing direct patient care."`
  },

  apidesign: {
    type: "interview",
    title: "API Design Process",
    question: "Walk me through your API design process. How do you decide what endpoints to create, how to structure them, and what to prioritize?",
    context: "Show that you think about users first, then technical implementation. Demonstrate understanding of REST principles and healthcare-specific considerations.",
    ideal: `"My API design starts with the clinical workflow, not the technical spec.<br><br>
<strong>Step 1 ‚Äî Map the User Journey:</strong> I start by mapping what the end users ‚Äî case managers, clinicians, administrators ‚Äî actually do each day. Each workflow task becomes a candidate endpoint: 'view my patients', 'run a screening', 'download a report'.<br><br>
<strong>Step 2 ‚Äî Apply REST Principles:</strong> Resources are nouns (patients, screenings, reports), actions are HTTP methods. GET /patients for listing, POST /screenings for creating, GET /reports/{id}/download for retrieving. I avoid verbs in URLs ‚Äî /run-screening is wrong, POST /screenings is right.<br><br>
<strong>Step 3 ‚Äî Design Data Contracts First:</strong> Before writing any route code, I write Pydantic schemas. This forces me to think about what data flows in and out. Medication adherence must be 0.0-1.0, never null. This catches design flaws before they become production bugs.<br><br>
<strong>Step 4 ‚Äî Add Security Layers:</strong> Every endpoint gets RBAC defined before it's built. Who can call this? Case managers see only their patients. Admins see all. This is especially important in healthcare ‚Äî a case manager accidentally seeing another clinic's patients is a HIPAA incident.<br><br>
<strong>Step 5 ‚Äî Plan for Audit:</strong> Every data access endpoint gets HIPAA audit logging built in from day one, not added later. Later never comes."`
  },

  sensitive: {
    type: "interview",
    title: "Handling Sensitive Patient Data",
    question: "How do you handle sensitive patient data in your systems? Walk me through your approach to data security and HIPAA compliance in MindBridge.",
    context: "This question tests both technical knowledge and healthcare domain understanding. Show that HIPAA is baked into the architecture, not bolted on.",
    ideal: `"I treat HIPAA compliance as architecture, not an afterthought. There are four layers in MindBridge:<br><br>
<strong>1. Data at Rest:</strong> The PostgreSQL database volume is encrypted with AES-256. PHI fields ‚Äî patient names, dates of birth ‚Äî are additionally encrypted at the application layer using Fernet symmetric encryption. Two independent encryption layers means a database dump is useless without both keys.<br><br>
<strong>2. Data in Transit:</strong> TLS 1.3 for all API connections. We enforce HTTPS-only ‚Äî any HTTP request redirects to HTTPS. JWT tokens are signed with RS256 and expire after 8 hours.<br><br>
<strong>3. Access Control:</strong> Role-based access control at the API layer, plus Row-Level Security in PostgreSQL. A case manager's query literally cannot return another case manager's patients ‚Äî it's enforced at the database level, not just the application level. Defense in depth.<br><br>
<strong>4. Audit Logging:</strong> Every access to PHI ‚Äî every patient view, every screening, every report download ‚Äî is logged to an immutable audit table with user_id, timestamp, IP address, and action. This is what HIPAA auditors look for after an incident. We also never hard-delete records ‚Äî soft deletes with deleted_at timestamps, because HIPAA requires retention.<br><br>
<strong>5. Version Control Hygiene:</strong> .gitignore excludes all generated reports and patient data. Environment variables for all credentials ‚Äî never in code. The .gitignore itself is a HIPAA compliance document in our repository."`
  },

  testing: {
    type: "interview",
    title: "Your Testing Strategy",
    question: "Walk me through your testing strategy for MindBridge. How do you ensure the AI doesn't give dangerous medical advice?",
    context: "Healthcare AI requires rigorous testing. Show you understand both technical testing AND clinical safety.",
    ideal: `<strong>Three-layer testing strategy:</strong><br><br>
<strong>LAYER 1 ‚Äî Unit Tests (Technical Safety):</strong><br>
Test each function in isolation using pytest.<br>
Example: test_patient_risk_calculation() verifies that medication_adherence=0.3 + appointments_missed=4 correctly flags as HIGH risk.<br>
Example: test_pydantic_validation() ensures medication_adherence=5.0 is rejected (must be 0.0-1.0).<br>
Coverage target: 90% of backend code.<br><br>
<strong>LAYER 2 ‚Äî Integration Tests (System Safety):</strong><br>
Test complete workflows end-to-end.<br>
Example: POST /api/analysis with real patient data ‚Üí verify Claude API is called ‚Üí verify response saved to database ‚Üí verify audit log entry created.<br>
Example: Test authentication ‚Äî 401 if no token, 403 if wrong role.<br><br>
<strong>LAYER 3 ‚Äî Clinical Guardrails (Patient Safety):</strong><br>
This is where my 10 years of clinical experience matters.<br>
<strong>Guardrail 1:</strong> AI can never automatically downgrade a patient from HIGH to MEDIUM risk. Only a licensed clinician can do that.<br>
<strong>Guardrail 2:</strong> If patient has crisis_calls_30days > 0, risk level is minimum MEDIUM regardless of other factors.<br>
<strong>Guardrail 3:</strong> AI suggestions are always labeled "AI-Generated - Requires Clinical Review" in the UI.<br>
<strong>Guardrail 4:</strong> All AI assessments log the exact prompt and response to audit_log for post-incident review.<br><br>
<strong>Real-world testing:</strong><br>
I'd also pilot with 5 case managers for 2 weeks before full rollout. Track: How often do they override the AI? What patterns emerge? Are false positives causing alert fatigue?<br><br>
<strong>Interview gold:</strong> "In healthcare AI, testing isn't just about code correctness. It's about clinical safety. The AI is a tool to help clinicians, not replace their judgment. That's why the guardrails prevent automated decisions on critical actions."`
  },

  bulkimport: {
    type: "interview",
    title: "Design Challenge - Bulk CSV Import",
    question: "A clinic wants to import 500 existing patients from a CSV file. How would you design this feature from scratch?",
    context: "This tests system design thinking, not just coding. Show you think about users, errors, performance, and safety.",
    ideal: `<strong>USER WORKFLOW FIRST:</strong><br>
Case manager uploads CSV with 500 patients ‚Üí System validates ‚Üí Imports ‚Üí Returns summary: "450 imported, 50 errors with reasons"<br><br>
<strong>TECHNICAL DESIGN:</strong><br><br>
<strong>STEP 1 ‚Äî Endpoint Design:</strong><br>
POST /patients/import accepts file upload (multipart/form-data)<br>
Returns 202 Accepted immediately with task_id (don't block ‚Äî 500 patients is too slow for sync request)<br><br>
<strong>STEP 2 ‚Äî Validation (Fail Fast):</strong><br>
Check: Is it a valid CSV? Required columns present (name, DOB, medication_adherence)?<br>
Return 400 Bad Request immediately if malformed ‚Äî don't waste time processing garbage.<br><br>
<strong>STEP 3 ‚Äî Background Processing (Celery Worker):</strong><br>
500 patients √ó 2 seconds each = 1000 seconds (16 minutes). Can't block a web request that long.<br>
Use Celery to process async. Frontend polls GET /imports/{task_id} for status.<br><br>
<strong>STEP 4 ‚Äî Row-Level Validation:</strong><br>
For each row: Pydantic validates data types. Check for duplicates (same name + DOB already in DB). Log invalid rows separately ‚Äî don't fail entire import for one bad row.<br><br>
<strong>STEP 5 ‚Äî Database Transaction:</strong><br>
Wrap ALL inserts in a single transaction. If DB fails mid-import, rollback everything ‚Äî no partial imports (150 patients in, 350 missing = data corruption).<br><br>
<strong>STEP 6 ‚Äî HIPAA Audit:</strong><br>
Log: Who uploaded (user_id). When (timestamp). Which file (filename, hash). How many patients (count). Store the original CSV temporarily for post-incident review if needed.<br><br>
<strong>STEP 7 ‚Äî Result Endpoint:</strong><br>
GET /imports/{task_id} returns:<br>
{status: "processing|completed|failed", imported: 450, errors: [{row: 23, reason: "Invalid medication_adherence: must be 0.0-1.0"}]}<br><br>
<strong>SECURITY CONSIDERATIONS:</strong><br>
File size limit (10MB max ‚Äî prevent DOS)<br>
Virus scan the CSV<br>
RBAC ‚Äî only admins can bulk import<br>
Rate limit ‚Äî 1 import per hour per user<br><br>
<strong>Interview gold:</strong> "I'd prototype with synchronous processing for 50 patients first, then add Celery when we hit scale. Always validate MVP assumptions with real usage before building complex async systems. Over-engineering early kills velocity."`
  },

  docker: {
    type: "concept",
    title: "Docker & Containerization",
    question: "Explain Docker and why MindBridge uses it. What problem does it solve, and what would happen without it?",
    context: "Go beyond the textbook definition. Tie it to healthcare reliability and the specific MindBridge use case.",
    ideal: `<strong>What Docker is:</strong> Docker packages an application and ALL its dependencies ‚Äî Python version, libraries, OS configurations ‚Äî into a portable container that runs identically everywhere.<br><br>
<strong>The problem it solves:</strong> Without Docker, "it works on my machine" is a patient safety issue. If the development environment uses Python 3.11 and production uses Python 3.9, subtle behavioral differences could cause risk assessments to produce different results. In healthcare, that's not a bug ‚Äî it's a clinical liability.<br><br>
<strong>MindBridge's docker-compose.yml has three services:</strong><br>
‚Ä¢ backend ‚Äî FastAPI on port 8000 with hot-reload for development<br>
‚Ä¢ db ‚Äî PostgreSQL 16 on port 5432 with health checks<br>
‚Ä¢ redis ‚Äî Redis 7 on port 6379 for caching and sessions<br><br>
<strong>The health check matters:</strong> depends_on with service_healthy ensures FastAPI won't start until PostgreSQL is confirmed ready. Without this, the app crashes on startup and a case manager can't log in.<br><br>
<strong>For a new developer:</strong> git clone + docker compose up = complete local environment in 60 seconds. Same database version, same Python version, same Redis. No "it works on my machine."`
  },

  postgres: {
    type: "concept",
    title: "PostgreSQL vs MongoDB",
    question: "Why did you choose PostgreSQL over MongoDB for MindBridge? When would MongoDB be the right choice?",
    context: "Show you understand the tradeoffs, not just that 'relational is better'. Healthcare-specific reasoning is key.",
    ideal: `<strong>Three reasons PostgreSQL for MindBridge:</strong><br><br>
<strong>1. ACID Transactions:</strong> When we run a risk screening, three things happen: INSERT screening result, UPDATE patient risk_level, INSERT audit_log entry. ALL three must succeed or NONE do ‚Äî no partial writes. In healthcare, a partial write could show a patient as 'low risk' while the actual screening says 'high risk'. MongoDB's document model can handle transactions, but they're more complex and less reliable under failure conditions.<br><br>
<strong>2. Row-Level Security:</strong> We enforce at the DATABASE level that case managers can only query their own patients ‚Äî not just the application level. If there's ever a bug in our FastAPI code, the database itself won't return unauthorized patient records. This defense-in-depth is what HIPAA auditors look for.<br><br>
<strong>3. JSONB for flexibility:</strong> We don't lose MongoDB's flexibility ‚Äî PostgreSQL's JSONB columns store the semi-structured AI analysis output alongside structured patient data. Best of both worlds.<br><br>
<strong>When MongoDB would be right:</strong> If we were storing unstructured clinical notes, medical images metadata, or building a feature with rapidly evolving schema where migrations would slow development, MongoDB would make sense as a supplementary store alongside PostgreSQL.`
  },

  hipaa: {
    type: "concept",
    title: "HIPAA Security Requirements",
    question: "What does the HIPAA Security Rule require for a system like MindBridge? How have you implemented these requirements?",
    context: "Most engineers know HIPAA exists but can't explain it technically. This is your chance to stand out.",
    ideal: `<strong>HIPAA Security Rule has three categories of safeguards:</strong><br><br>
<strong>Technical Safeguards (what we build):</strong><br>
‚Ä¢ Encryption at rest: AES-256 for database volumes + application-level field encryption for PHI<br>
‚Ä¢ Encryption in transit: TLS 1.3 for all connections, HTTPS-only<br>
‚Ä¢ Access controls: JWT authentication + RBAC + PostgreSQL Row-Level Security<br>
‚Ä¢ Audit controls: Immutable audit_log table ‚Äî every PHI access recorded with user, timestamp, IP, action<br>
‚Ä¢ Automatic logoff: JWT tokens expire after 8 hours of inactivity<br><br>
<strong>Physical Safeguards (infrastructure):</strong><br>
‚Ä¢ Covered by cloud providers (AWS, Vercel, Railway) via Business Associate Agreements (BAAs)<br>
‚Ä¢ The BAA is the legal contract saying the cloud provider is also HIPAA-responsible<br><br>
<strong>Administrative Safeguards (policies):</strong><br>
‚Ä¢ Access review process: who can access what, reviewed quarterly<br>
‚Ä¢ Workforce training: documented security training for all staff<br>
‚Ä¢ Incident response plan: documented procedure for breach notification (72-hour rule)<br><br>
<strong>The 72-hour rule:</strong> If patient data is breached, you have 72 hours to notify affected patients and HHS. This is why our incident detection and audit logging is real-time, not batch.`
  },

  pooling: {
    type: "concept",
    title: "Connection Pooling Deep Dive",
    question: "You mentioned connection pooling in your resume. Explain what it is, why MindBridge needs it, and what happens when the pool is exhausted.",
    context: "This tests real production database knowledge, not just theory.",
    ideal: `<strong>What connection pooling is:</strong><br>
Connection pooling reuses database connections instead of opening a new one for every request. Think of it like a shared bike system ‚Äî bikes sit ready to use, you don't build a new bike each time.<br><br>
<strong>Why it matters for MindBridge:</strong><br>
Opening a PostgreSQL connection takes 50-100ms. If 100 case managers hit the dashboard simultaneously:<br>
WITHOUT pooling: 100 √ó 100ms = 10 seconds of pure connection overhead. The last user waits 10 seconds just to START their query.<br>
WITH pooling: 10 persistent connections ready. Requests queue and reuse existing connections. Max wait ‚âà query time, not connection time.<br><br>
<strong>MindBridge configuration:</strong><br>
engine = create_async_engine('postgresql://...', pool_size=10, max_overflow=20)<br>
This means: 10 persistent connections, can burst to 30 under heavy load.<br><br>
<strong>What happens when pool exhausted:</strong><br>
Error: 'QueuePool limit of size 10 overflow 20 reached, connection timed out'<br>
Users see: 500 Internal Server Error<br>
Real impact: Dashboard stops working during peak hours (morning when all case managers log in)<br><br>
<strong>How to fix:</strong><br>
Increase pool_size (but don't go crazy ‚Äî PostgreSQL has connection limits too)<br>
Find connection leaks (endpoints not closing DB sessions)<br>
Add connection pooling metrics to monitoring<br><br>
<strong>Interview gold:</strong> "Connection pooling is why MindBridge can handle 50 concurrent users on a single backend instance. Without it, we'd need 10√ó the server capacity or users would experience random timeouts."`
  }
};

let sessionCompleted = 0;
let sessionRatings = [];
let currentScenarioKey = null;
const scenarioOrder = Object.keys(scenarios);

function loadScenario(key) {
  currentScenarioKey = key;
  const s = scenarios[key];
  if (!s) return;

  // Hide welcome, show content
  document.getElementById('welcome').style.display = 'none';
  const content = document.getElementById('scenario-content');
  content.style.display = 'flex';

  // Update active button
  document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
  const btn = document.getElementById('btn-' + key);
  if (btn) btn.classList.add('active');

  // Set type badge
  const badge = document.getElementById('scenario-type-badge');
  const typeMap = {
    simulation: ['type-sim', 'üé≠ Simulation'],
    interview: ['type-int', 'üé§ Interview'],
    concept: ['type-con', 'üí° Concept']
  };
  const [cls, label] = typeMap[s.type] || ['type-con', 'üí° Concept'];
  badge.className = 'scenario-type ' + cls;
  badge.textContent = label;

  // Set question
  document.getElementById('scenario-question').textContent = s.question;

  // Set context
  const ctx = document.getElementById('scenario-context');
  if (s.context) {
    ctx.textContent = s.context;
    ctx.style.display = 'block';
  } else {
    ctx.style.display = 'none';
  }

  // Reset answer area
  document.getElementById('user-answer').value = '';
  document.getElementById('ideal-answer').classList.remove('show');
  document.getElementById('rating-section').classList.remove('show');
  document.getElementById('feedback-panel').classList.remove('show');
  document.getElementById('reveal-btn').style.display = 'inline-block';
  document.getElementById('loading-indicator').classList.remove('show');

  // Scroll to top
  document.getElementById('stage').scrollTop = 0;
}

function revealAnswer() {
  const s = scenarios[currentScenarioKey];
  if (!s) return;

  document.getElementById('reveal-btn').style.display = 'none';
  document.getElementById('ideal-text').innerHTML = s.ideal;
  document.getElementById('ideal-answer').classList.add('show');
  document.getElementById('rating-section').classList.add('show');

  // Scroll to ideal answer
  setTimeout(() => {
    document.getElementById('ideal-answer').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

function rateAnswer(rating) {
  const s = scenarios[currentScenarioKey];
  if (!s) return;

  sessionRatings.push(rating);
  sessionCompleted++;
  updateStats();

  const feedback = document.getElementById('feedback-panel');
  const title = document.getElementById('feedback-title');
  const text = document.getElementById('feedback-text');
  const tags = document.getElementById('feedback-tags');

  const messages = {
    1: {
      icon: '‚ùå', color: '#ef4444',
      title: 'No worries ‚Äî this is how you learn!',
      text: 'The ideal answer is now in your memory. Run through this scenario again tomorrow. Repetition is how expertise is built. Most candidates never practice like this.',
      tagStyle: 'background:#ef444420; color:#ef4444; border:1px solid #ef444440;',
      tags: ['Review Tomorrow', 'Keep Going', 'Part of the Process']
    },
    2: {
      icon: 'üòì', color: '#f59e0b',
      title: 'Good attempt ‚Äî you have the foundation!',
      text: 'You knew parts of it. Focus on the specific points you missed. In interviews, a partial answer is far better than silence. Build on what you know.',
      tagStyle: 'background:#f59e0b20; color:#f59e0b; border:1px solid #f59e0b40;',
      tags: ['Building Knowledge', 'Getting There', 'Review Key Points']
    },
    3: {
      icon: '‚úì', color: '#22c55e',
      title: 'Solid! You understand this topic.',
      text: "You've got the core concepts. Keep practicing to sharpen the precise language ‚Äî interviewers are impressed by specificity. You're interview-ready on this topic.",
      tagStyle: 'background:#22c55e20; color:#22c55e; border:1px solid #22c55e40;',
      tags: ['Interview Ready', 'Strong Foundation', 'Sharpen Details']
    },
    4: {
      icon: '‚≠ê', color: '#4f8ef7',
      title: 'Excellent! This answer is yours.',
      text: "You nailed it. When this comes up in an interview, you'll answer with confidence. Your 10 years of clinical experience + this technical depth is a powerful combination.",
      tagStyle: 'background:#4f8ef720; color:#4f8ef7; border:1px solid #4f8ef740;',
      tags: ['Mastered', 'üíº Interview Ready', 'üöÄ Keep Going']
    }
  };

  const m = messages[rating];
  title.innerHTML = `<span style="color:${m.color}">${m.icon}</span> ${m.title}`;
  text.textContent = m.text;
  tags.innerHTML = m.tags.map(t =>
    `<span class="feedback-tag" style="${m.tagStyle}">${t}</span>`
  ).join('');

  feedback.classList.add('show');

  setTimeout(() => {
    feedback.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

function nextScenario() {
  const keys = Object.keys(scenarios);
  const idx = keys.indexOf(currentScenarioKey);
  const nextKey = keys[(idx + 1) % keys.length];
  loadScenario(nextKey);
}

function updateStats() {
  document.getElementById('stat-completed').textContent = sessionCompleted;
  if (sessionRatings.length > 0) {
    const avg = (sessionRatings.reduce((a, b) => a + b, 0) / sessionRatings.length).toFixed(1);
    document.getElementById('stat-score').textContent = avg + '/4';
  }
}
</script>
</body>
</html>