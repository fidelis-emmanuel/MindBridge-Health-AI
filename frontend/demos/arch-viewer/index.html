<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindbridge Architecture Viewer - Split View</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PrismJS for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        .pane {
            flex: 1;
            height: 100%;
            overflow: auto;
            position: relative;
        }

        .pane-left {
            border-right: 1px solid #334155;
            background: #1e293b;
        }

        .pane-right {
            background: #050A14; /* Match the component background */
        }

        .pane-header {
            position: sticky;
            top: 0;
            left: 0;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(4px);
            border-bottom: 1px solid #334155;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #94a3b8;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        pre {
            margin: 0 !important;
            padding: 20px !important;
            border-radius: 0 !important;
            background: transparent !important;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Left Pane: Source Code -->
    <div class="pane pane-left">
        <div class="pane-header">
            <span>Mindbridge architecture.jsx</span>
            <span>JAVASCRIPT (JSX)</span>
        </div>
        <pre><code id="code-display" class="language-jsx">
<!-- Code will be injected here -->
        </code></pre>
    </div>

    <!-- Right Pane: Live Render -->
    <div class="pane pane-right">
        <div class="pane-header" style="background: rgba(5, 10, 20, 0.9);">
            <span>Visual Interface</span>
            <span>PREVIEW</span>
        </div>
        <div id="root"></div>
    </div>
</div>

<!-- The Source Code -->
<script type="text/plain" id="source-code">
import { useState } from "react";

const layers = [
  {
    id: "users",
    label: "USER LAYER",
    color: "#0EA5E9",
    glow: "rgba(14,165,233,0.35)",
    nodes: [
      { id: "patient", icon: "üßë‚Äç‚öïÔ∏è", label: "Patient Portal", sub: "Next.js" },
      { id: "physician", icon: "üë®‚Äç‚öïÔ∏è", label: "Physician Dashboard", sub: "React + TypeScript" },
      { id: "staff", icon: "üè•", label: "Staff Interface", sub: "React + TypeScript" },
      { id: "admin", icon: "‚öôÔ∏è", label: "Admin Console", sub: "React + TypeScript" },
    ],
  },
  {
    id: "gateway",
    label: "SECURITY & GATEWAY LAYER",
    color: "#F59E0B",
    glow: "rgba(245,158,11,0.35)",
    nodes: [
      { id: "apigw", icon: "üîÄ", label: "API Gateway", sub: "AWS API Gateway / Kong" },
      { id: "auth", icon: "üîê", label: "Identity & Auth", sub: "AWS Cognito + Auth0 (RBAC)" },
      { id: "waf", icon: "üõ°Ô∏è", label: "WAF + Firewall", sub: "AWS WAF + Shield" },
      { id: "audit", icon: "üìã", label: "Audit Trail", sub: "AWS CloudTrail" },
    ],
  },
  {
    id: "api",
    label: "APPLICATION LAYER",
    color: "#8B5CF6",
    glow: "rgba(139,92,246,0.35)",
    nodes: [
      { id: "fastapi", icon: "‚ö°", label: "FastAPI Backend", sub: "Python ¬∑ REST + WebSockets" },
      { id: "celery", icon: "‚è±Ô∏è", label: "Task Queue", sub: "Celery + Redis" },
      { id: "fhir", icon: "üîó", label: "FHIR R4 Engine", sub: "HL7 Interoperability" },
      { id: "ws", icon: "üí¨", label: "Real-time Messaging", sub: "WebSocket ¬∑ Encrypted" },
    ],
  },
  {
    id: "ai",
    label: "AI & ML LAYER",
    color: "#10B981",
    glow: "rgba(16,185,129,0.35)",
    nodes: [
      { id: "claude", icon: "ü§ñ", label: "Claude API", sub: "Clinical Notes ¬∑ Triage ¬∑ Coding" },
      { id: "stt", icon: "üéôÔ∏è", label: "Speech-to-Text", sub: "AWS Transcribe Medical" },
      { id: "nlp", icon: "üß†", label: "NLP Pipeline", sub: "ICD-10 ¬∑ CPT Extraction" },
      { id: "validation", icon: "‚úÖ", label: "AI Validator", sub: "Hallucination Guard ¬∑ Review Gate" },
    ],
  },
  {
    id: "data",
    label: "DATA LAYER",
    color: "#EF4444",
    glow: "rgba(239,68,68,0.35)",
    nodes: [
      { id: "postgres", icon: "üóÑÔ∏è", label: "PostgreSQL (RDS)", sub: "Primary ¬∑ HIPAA Encrypted" },
      { id: "replica", icon: "üìä", label: "Analytics Replica", sub: "Read-only ¬∑ Metabase" },
      { id: "s3", icon: "üóÉÔ∏è", label: "Document Store", sub: "AWS S3 ¬∑ AES-256" },
      { id: "kms", icon: "üîë", label: "Key Management", sub: "AWS KMS ¬∑ Field Encryption" },
    ],
  },
  {
    id: "integrations",
    label: "EXTERNAL INTEGRATIONS",
    color: "#EC4899",
    glow: "rgba(236,72,153,0.35)",
    nodes: [
      { id: "lab", icon: "üß™", label: "Lab Systems", sub: "HL7 v2 ¬∑ FHIR Results" },
      { id: "pharmacy", icon: "üíä", label: "Pharmacy / eRx", sub: "Surescripts ¬∑ DEA Compliant" },
      { id: "insurance", icon: "üìÑ", label: "Insurance / Payers", sub: "Availity ¬∑ Change Healthcare" },
      { id: "comms", icon: "üì±", label: "Patient Comms", sub: "Twilio SMS ¬∑ SendGrid" },
    ],
  },
];

const detailMap = {
  patient: { title: "Patient Portal", desc: "Secure scheduling, messaging, lab results, prescription refills, AI health assistant with plain-language explanations. 15-min session timeout (HIPAA)." },
  physician: { title: "Physician Dashboard", desc: "Ambient documentation, SOAP note generation, clinical decision support, AI-suggested ICD-10/CPT codes, encounter timeline." },
  staff: { title: "Staff Interface", desc: "HIPAA-compliant internal messaging, smart routing, shift handoff summaries, alert escalation to on-call providers." },
  admin: { title: "Admin Console", desc: "User management, RBAC configuration, system health, compliance reporting, AI performance metrics." },
  apigw: { title: "API Gateway", desc: "Single security perimeter for all traffic. Rate limiting, API key rotation, request logging, anomaly detection, DDoS protection." },
  auth: { title: "Identity & Auth", desc: "SAML/SSO, MFA enforced on all accounts. Role matrix: Physician ‚Üí Nurse ‚Üí Front Desk ‚Üí Billing ‚Üí Admin. AI gets scoped least-privilege access." },
  waf: { title: "WAF + Firewall", desc: "AWS WAF blocks SQL injection, XSS, bot traffic. All resources deployed inside private VPC subnets ‚Äî no database ever faces the public internet." },
  audit: { title: "Audit Trail", desc: "CloudTrail logs every API call. Who accessed which PHI, when, from where. Tamper-proof, retained 7 years. Required for HIPAA Technical Safeguards." },
  fastapi: { title: "FastAPI Backend", desc: "Python async API. Handles patient data, clinical workflows, billing logic. Deployed on AWS ECS Fargate. Auto-scales with demand." },
  celery: { title: "Task Queue", desc: "Async jobs: weekly AI reports (Mon 6am), claim status monitoring, lab result notifications, eligibility verification at check-in." },
  fhir: { title: "FHIR R4 Engine", desc: "All data modeled as FHIR resources: Patient, Encounter, Observation, Condition, MedicationRequest, Appointment. Enables interoperability with any FHIR-compliant system." },
  ws: { title: "Real-time Messaging", desc: "FastAPI native WebSockets. End-to-end encrypted messages. HIPAA-compliant alternative to Slack/Teams. TigerConnect or custom build." },
  claude: { title: "Claude API (Anthropic)", desc: "Core AI engine. Clinical documentation drafts, patient triage, billing code suggestions, denial appeal language, weekly executive reports. Every output is a draft until physician-signed." },
  stt: { title: "Speech-to-Text", desc: "AWS Transcribe Medical converts encounter audio to transcript with medical vocabulary. Patient consent captured before recording. Saves physicians 2‚Äì3 hrs/day." },
  nlp: { title: "NLP Pipeline", desc: "Extracts ICD-10 diagnosis codes and CPT procedure codes from signed clinical notes. Feeds directly into billing module. Can increase clinic revenue 15‚Äì25%." },
  validation: { title: "AI Validator", desc: "Every AI output passes through a validation layer before reaching clinical workflows. Flags hallucinations, missing required fields, unsigned notes blocked from downstream systems." },
  postgres: { title: "PostgreSQL (RDS)", desc: "Primary operational database. AES-256 encryption at rest. Multi-AZ for 99.99% uptime. NEVER hard-delete records ‚Äî soft deletes with deleted_at timestamps only." },
  replica: { title: "Analytics Replica", desc: "Read-only replica feeds Metabase dashboards. Tracks no-show rates, door-to-provider time, claim denial rates, AI adoption metrics. Zero impact on production performance." },
  s3: { title: "Document Store", desc: "S3 for clinical documents, images, insurance cards, outside records. Versioned, AES-256, lifecycle policies for HIPAA retention. Pre-signed URLs for secure access." },
  kms: { title: "Key Management", desc: "AWS KMS manages all encryption keys. Automatic rotation. Field-level encryption for SSN, DOB, and other high-sensitivity PHI fields in PostgreSQL." },
  lab: { title: "Lab Systems", desc: "Bi-directional HL7 v2 or FHIR integration. Results auto-filed to patient record. AI flags critical values (panic labs) and notifies ordering provider within 60 seconds." },
  pharmacy: { title: "Pharmacy / eRx", desc: "Surescripts integration for e-prescribing. DEA EPCS compliant for controlled substances. Medication history pulled at every encounter." },
  insurance: { title: "Insurance / Payers", desc: "Real-time eligibility verification at check-in via Availity. Copay displayed before patient is seen. Claim submission, status tracking, denial management." },
  comms: { title: "Patient Comms", desc: "Twilio for HIPAA-safe SMS (no PHI in message body ‚Äî link to secure portal instead). SendGrid for email notifications. Appointment reminders reduce no-shows 30‚Äì40%." },
};

export default function ArchDiagram() {
  const [active, setActive] = useState(null);
  const detail = active ? detailMap[active] : null;

  return (
    <div style={{
      background: "#050A14",
      minHeight: "100vh",
      fontFamily: "'Courier New', monospace",
      color: "#E2E8F0",
      padding: "32px 24px",
      position: "relative",
      overflow: "hidden",
    }}>
      {/* Background grid */}
      <div style={{
        position: "fixed", inset: 0, zIndex: 0,
        backgroundImage: "linear-gradient(rgba(14,165,233,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(14,165,233,0.04) 1px, transparent 1px)",
        backgroundSize: "40px 40px",
        pointerEvents: "none",
      }} />

      <div style={{ position: "relative", zIndex: 1, maxWidth: 1100, margin: "0 auto" }}>
        {/* Header */}
        <div style={{ textAlign: "center", marginBottom: 40 }}>
          <div style={{ fontSize: 11, letterSpacing: 6, color: "#0EA5E9", marginBottom: 8 }}>
            MINDBRIDGE HEALTH AI ¬∑ SYSTEM ARCHITECTURE
          </div>
          <h1 style={{
            fontSize: 28, fontWeight: 700, margin: 0,
            background: "linear-gradient(90deg, #0EA5E9, #8B5CF6, #10B981)",
            WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent",
            letterSpacing: 2,
          }}>
            END-TO-END HEALTHCARE INFRASTRUCTURE
          </h1>
          <div style={{ fontSize: 11, color: "#475569", marginTop: 8, letterSpacing: 3 }}>
            HIPAA COMPLIANT ¬∑ FHIR R4 ¬∑ AWS ¬∑ FastAPI ¬∑ PostgreSQL ¬∑ Claude API
          </div>
        </div>

        {/* Compliance badges */}
        <div style={{ display: "flex", justifyContent: "center", gap: 12, marginBottom: 36, flexWrap: "wrap" }}>
          {["HIPAA", "FHIR R4", "HL7 v2", "BAA SIGNED", "SOC 2", "AES-256", "MFA ENFORCED"].map(b => (
            <span key={b} style={{
              border: "1px solid rgba(14,165,233,0.3)",
              borderRadius: 3,
              padding: "3px 10px",
              fontSize: 10,
              letterSpacing: 2,
              color: "#0EA5E9",
              background: "rgba(14,165,233,0.06)",
            }}>{b}</span>
          ))}
        </div>

        {/* Layers */}
        {layers.map((layer, li) => (
          <div key={layer.id} style={{ marginBottom: 6 }}>
            {/* Layer label */}
            <div style={{
              fontSize: 10, letterSpacing: 4, color: layer.color,
              marginBottom: 6, paddingLeft: 4,
              borderLeft: `2px solid ${layer.color}`,
              paddingTop: 2, paddingBottom: 2,
            }}>
              {layer.label}
            </div>

            {/* Nodes row */}
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(4, 1fr)",
              gap: 8,
              background: `rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.04)`,
              border: `1px solid rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.15)`,
              borderRadius: 6,
              padding: 12,
            }}>
              {layer.nodes.map(node => (
                <button
                  key={node.id}
                  onClick={() => setActive(active === node.id ? null : node.id)}
                  style={{
                    background: active === node.id
                      ? `rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.2)`
                      : "rgba(255,255,255,0.03)",
                    border: `1px solid ${active === node.id ? layer.color : "rgba(255,255,255,0.08)"}`,
                    borderRadius: 6,
                    padding: "12px 10px",
                    cursor: "pointer",
                    textAlign: "left",
                    transition: "all 0.15s ease",
                    boxShadow: active === node.id ? `0 0 16px ${layer.glow}` : "none",
                    color: "#E2E8F0",
                    width: "100%", /* fixed to ensure grid layout */
                  }}
                  onMouseEnter={e => {
                    if (active !== node.id) {
                      e.currentTarget.style.borderColor = layer.color;
                      e.currentTarget.style.background = `rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.08)`;
                    }
                  }}
                  onMouseLeave={e => {
                    if (active !== node.id) {
                      e.currentTarget.style.borderColor = "rgba(255,255,255,0.08)";
                      e.currentTarget.style.background = "rgba(255,255,255,0.03)";
                    }
                  }}
                >
                  <div style={{ fontSize: 20, marginBottom: 5 }}>{node.icon}</div>
                  <div style={{ fontSize: 11, fontWeight: 700, color: layer.color, letterSpacing: 0.5, marginBottom: 3 }}>
                    {node.label}
                  </div>
                  <div style={{ fontSize: 9.5, color: "#64748B", letterSpacing: 0.3, lineHeight: 1.4 }}>
                    {node.sub}
                  </div>
                </button>
              ))}
            </div>

            {/* Connector arrow */}
            {li < layers.length - 1 && (
              <div style={{ textAlign: "center", padding: "4px 0", color: "#1E3A5F", fontSize: 16 }}>
                ‚ñº
              </div>
            )}
          </div>
        ))}

        {/* Detail panel */}
        {detail && (
          <div style={{
            marginTop: 24,
            background: "rgba(14,165,233,0.06)",
            border: "1px solid rgba(14,165,233,0.3)",
            borderRadius: 8,
            padding: "20px 24px",
            animation: "fadeIn 0.2s ease",
          }}>
            <style>{`@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }`}</style>
            <div style={{ fontSize: 10, letterSpacing: 4, color: "#0EA5E9", marginBottom: 6 }}>COMPONENT DETAIL</div>
            <div style={{ fontSize: 15, fontWeight: 700, color: "#E2E8F0", marginBottom: 8 }}>{detail.title}</div>
            <div style={{ fontSize: 12.5, color: "#94A3B8", lineHeight: 1.7 }}>{detail.desc}</div>
          </div>
        )}

        {/* Data flow legend */}
        <div style={{
          marginTop: 28,
          display: "grid",
          gridTemplateColumns: "repeat(3, 1fr)",
          gap: 12,
        }}>
          {[
            { icon: "üîí", label: "All PHI encrypted at rest (AES-256) and in transit (TLS 1.3)" },
            { icon: "üìù", label: "Every AI output is a DRAFT until physician-signed. Status: draft ‚Üí reviewed ‚Üí signed" },
            { icon: "üö´", label: "No hard deletes. All records use soft-delete with deleted_at timestamps" },
          ].map((item, i) => (
            <div key={i} style={{
              background: "rgba(255,255,255,0.02)",
              border: "1px solid rgba(255,255,255,0.06)",
              borderRadius: 6,
              padding: "12px 14px",
              display: "flex",
              gap: 10,
              alignItems: "flex-start",
            }}>
              <span style={{ fontSize: 16, flexShrink: 0 }}>{item.icon}</span>
              <span style={{ fontSize: 10.5, color: "#64748B", lineHeight: 1.5 }}>{item.label}</span>
            </div>
          ))}
        </div>

        {/* Footer */}
        <div style={{ textAlign: "center", marginTop: 28, fontSize: 10, color: "#1E3A5F", letterSpacing: 3 }}>
          MINDBRIDGE HEALTH AI ¬∑ WEEK 2 ¬∑ FIDELIS EMMANUEL ¬∑ HEALTHCARE AI ENGINEER IN TRAINING
        </div>
      </div>
    </div>
  );
}
</script>

<script type="text/babel">
    // Logic to run the component
    const { useState } = React;
    
    // Grab the source code text to display in the left pane
    const sourceCode = document.getElementById('source-code').textContent;
    document.getElementById('code-display').textContent = sourceCode;

    // Grab the component code logic (minus the export default) to run in the right pane
    // Note: We need to make sure the ArchDiagram and data constants are available in this scope.
    // The easiest way is to just duplicate the logic here or eval it. 
    // Since we are in a simple HTML file, I will just paste the component logic again 
    // inside this script tag for execution.
    
    const layers = [
      {
        id: "users",
        label: "USER LAYER",
        color: "#0EA5E9",
        glow: "rgba(14,165,233,0.35)",
        nodes: [
          { id: "patient", icon: "üßë‚Äç‚öïÔ∏è", label: "Patient Portal", sub: "Next.js" },
          { id: "physician", icon: "üë®‚Äç‚öïÔ∏è", label: "Physician Dashboard", sub: "React + TypeScript" },
          { id: "staff", icon: "üè•", label: "Staff Interface", sub: "React + TypeScript" },
          { id: "admin", icon: "‚öôÔ∏è", label: "Admin Console", sub: "React + TypeScript" },
        ],
      },
      {
        id: "gateway",
        label: "SECURITY & GATEWAY LAYER",
        color: "#F59E0B",
        glow: "rgba(245,158,11,0.35)",
        nodes: [
          { id: "apigw", icon: "üîÄ", label: "API Gateway", sub: "AWS API Gateway / Kong" },
          { id: "auth", icon: "üîê", label: "Identity & Auth", sub: "AWS Cognito + Auth0 (RBAC)" },
          { id: "waf", icon: "üõ°Ô∏è", label: "WAF + Firewall", sub: "AWS WAF + Shield" },
          { id: "audit", icon: "üìã", label: "Audit Trail", sub: "AWS CloudTrail" },
        ],
      },
      {
        id: "api",
        label: "APPLICATION LAYER",
        color: "#8B5CF6",
        glow: "rgba(139,92,246,0.35)",
        nodes: [
          { id: "fastapi", icon: "‚ö°", label: "FastAPI Backend", sub: "Python ¬∑ REST + WebSockets" },
          { id: "celery", icon: "‚è±Ô∏è", label: "Task Queue", sub: "Celery + Redis" },
          { id: "fhir", icon: "üîó", label: "FHIR R4 Engine", sub: "HL7 Interoperability" },
          { id: "ws", icon: "üí¨", label: "Real-time Messaging", sub: "WebSocket ¬∑ Encrypted" },
        ],
      },
      {
        id: "ai",
        label: "AI & ML LAYER",
        color: "#10B981",
        glow: "rgba(16,185,129,0.35)",
        nodes: [
          { id: "claude", icon: "ü§ñ", label: "Claude API", sub: "Clinical Notes ¬∑ Triage ¬∑ Coding" },
          { id: "stt", icon: "üéôÔ∏è", label: "Speech-to-Text", sub: "AWS Transcribe Medical" },
          { id: "nlp", icon: "üß†", label: "NLP Pipeline", sub: "ICD-10 ¬∑ CPT Extraction" },
          { id: "validation", icon: "‚úÖ", label: "AI Validator", sub: "Hallucination Guard ¬∑ Review Gate" },
        ],
      },
      {
        id: "data",
        label: "DATA LAYER",
        color: "#EF4444",
        glow: "rgba(239,68,68,0.35)",
        nodes: [
          { id: "postgres", icon: "üóÑÔ∏è", label: "PostgreSQL (RDS)", sub: "Primary ¬∑ HIPAA Encrypted" },
          { id: "replica", icon: "üìä", label: "Analytics Replica", sub: "Read-only ¬∑ Metabase" },
          { id: "s3", icon: "üóÉÔ∏è", label: "Document Store", sub: "AWS S3 ¬∑ AES-256" },
          { id: "kms", icon: "üîë", label: "Key Management", sub: "AWS KMS ¬∑ Field Encryption" },
        ],
      },
      {
        id: "integrations",
        label: "EXTERNAL INTEGRATIONS",
        color: "#EC4899",
        glow: "rgba(236,72,153,0.35)",
        nodes: [
          { id: "lab", icon: "üß™", label: "Lab Systems", sub: "HL7 v2 ¬∑ FHIR Results" },
          { id: "pharmacy", icon: "üíä", label: "Pharmacy / eRx", sub: "Surescripts ¬∑ DEA Compliant" },
          { id: "insurance", icon: "üìÑ", label: "Insurance / Payers", sub: "Availity ¬∑ Change Healthcare" },
          { id: "comms", icon: "üì±", label: "Patient Comms", sub: "Twilio SMS ¬∑ SendGrid" },
        ],
      },
    ];

    const detailMap = {
      patient: { title: "Patient Portal", desc: "Secure scheduling, messaging, lab results, prescription refills, AI health assistant with plain-language explanations. 15-min session timeout (HIPAA)." },
      physician: { title: "Physician Dashboard", desc: "Ambient documentation, SOAP note generation, clinical decision support, AI-suggested ICD-10/CPT codes, encounter timeline." },
      staff: { title: "Staff Interface", desc: "HIPAA-compliant internal messaging, smart routing, shift handoff summaries, alert escalation to on-call providers." },
      admin: { title: "Admin Console", desc: "User management, RBAC configuration, system health, compliance reporting, AI performance metrics." },
      apigw: { title: "API Gateway", desc: "Single security perimeter for all traffic. Rate limiting, API key rotation, request logging, anomaly detection, DDoS protection." },
      auth: { title: "Identity & Auth", desc: "SAML/SSO, MFA enforced on all accounts. Role matrix: Physician ‚Üí Nurse ‚Üí Front Desk ‚Üí Billing ‚Üí Admin. AI gets scoped least-privilege access." },
      waf: { title: "WAF + Firewall", desc: "AWS WAF blocks SQL injection, XSS, bot traffic. All resources deployed inside private VPC subnets ‚Äî no database ever faces the public internet." },
      audit: { title: "Audit Trail", desc: "CloudTrail logs every API call. Who accessed which PHI, when, from where. Tamper-proof, retained 7 years. Required for HIPAA Technical Safeguards." },
      fastapi: { title: "FastAPI Backend", desc: "Python async API. Handles patient data, clinical workflows, billing logic. Deployed on AWS ECS Fargate. Auto-scales with demand." },
      celery: { title: "Task Queue", desc: "Async jobs: weekly AI reports (Mon 6am), claim status monitoring, lab result notifications, eligibility verification at check-in." },
      fhir: { title: "FHIR R4 Engine", desc: "All data modeled as FHIR resources: Patient, Encounter, Observation, Condition, MedicationRequest, Appointment. Enables interoperability with any FHIR-compliant system." },
      ws: { title: "Real-time Messaging", desc: "FastAPI native WebSockets. End-to-end encrypted messages. HIPAA-compliant alternative to Slack/Teams. TigerConnect or custom build." },
      claude: { title: "Claude API (Anthropic)", desc: "Core AI engine. Clinical documentation drafts, patient triage, billing code suggestions, denial appeal language, weekly executive reports. Every output is a draft until physician-signed." },
      stt: { title: "Speech-to-Text", desc: "AWS Transcribe Medical converts encounter audio to transcript with medical vocabulary. Patient consent captured before recording. Saves physicians 2‚Äì3 hrs/day." },
      nlp: { title: "NLP Pipeline", desc: "Extracts ICD-10 diagnosis codes and CPT procedure codes from signed clinical notes. Feeds directly into billing module. Can increase clinic revenue 15‚Äì25%." },
      validation: { title: "AI Validator", desc: "Every AI output passes through a validation layer before reaching clinical workflows. Flags hallucinations, missing required fields, unsigned notes blocked from downstream systems." },
      postgres: { title: "PostgreSQL (RDS)", desc: "Primary operational database. AES-256 encryption at rest. Multi-AZ for 99.99% uptime. NEVER hard-delete records ‚Äî soft deletes with deleted_at timestamps only." },
      replica: { title: "Analytics Replica", desc: "Read-only replica feeds Metabase dashboards. Tracks no-show rates, door-to-provider time, claim denial rates, AI adoption metrics. Zero impact on production performance." },
      s3: { title: "Document Store", desc: "S3 for clinical documents, images, insurance cards, outside records. Versioned, AES-256, lifecycle policies for HIPAA retention. Pre-signed URLs for secure access." },
      kms: { title: "Key Management", desc: "AWS KMS manages all encryption keys. Automatic rotation. Field-level encryption for SSN, DOB, and other high-sensitivity PHI fields in PostgreSQL." },
      lab: { title: "Lab Systems", desc: "Bi-directional HL7 v2 or FHIR integration. Results auto-filed to patient record. AI flags critical values (panic labs) and notifies ordering provider within 60 seconds." },
      pharmacy: { title: "Pharmacy / eRx", desc: "Surescripts integration for e-prescribing. DEA EPCS compliant for controlled substances. Medication history pulled at every encounter." },
      insurance: { title: "Insurance / Payers", desc: "Real-time eligibility verification at check-in via Availity. Copay displayed before patient is seen. Claim submission, status tracking, denial management." },
      comms: { title: "Patient Comms", desc: "Twilio for HIPAA-safe SMS (no PHI in message body ‚Äî link to secure portal instead). SendGrid for email notifications. Appointment reminders reduce no-shows 30‚Äì40%." },
    };

    function ArchDiagram() {
      const [active, setActive] = useState(null);
      const detail = active ? detailMap[active] : null;

      return (
        <div style={{
          background: "#050A14",
          minHeight: "100vh",
          fontFamily: "'Courier New', monospace",
          color: "#E2E8F0",
          padding: "32px 24px",
          position: "relative",
          overflow: "hidden",
        }}>
          {/* Background grid */}
          <div style={{
            position: "fixed", inset: 0, zIndex: 0,
            backgroundImage: "linear-gradient(rgba(14,165,233,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(14,165,233,0.04) 1px, transparent 1px)",
            backgroundSize: "40px 40px",
            pointerEvents: "none",
          }} />

          <div style={{ position: "relative", zIndex: 1, maxWidth: 1100, margin: "0 auto" }}>
            {/* Header */}
            <div style={{ textAlign: "center", marginBottom: 40 }}>
              <div style={{ fontSize: 11, letterSpacing: 6, color: "#0EA5E9", marginBottom: 8 }}>
                MINDBRIDGE HEALTH AI ¬∑ SYSTEM ARCHITECTURE
              </div>
              <h1 style={{
                fontSize: 28, fontWeight: 700, margin: 0,
                background: "linear-gradient(90deg, #0EA5E9, #8B5CF6, #10B981)",
                WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent",
                letterSpacing: 2,
              }}>
                END-TO-END HEALTHCARE INFRASTRUCTURE
              </h1>
              <div style={{ fontSize: 11, color: "#475569", marginTop: 8, letterSpacing: 3 }}>
                HIPAA COMPLIANT ¬∑ FHIR R4 ¬∑ AWS ¬∑ FastAPI ¬∑ PostgreSQL ¬∑ Claude API
              </div>
            </div>

            {/* Compliance badges */}
            <div style={{ display: "flex", justifyContent: "center", gap: 12, marginBottom: 36, flexWrap: "wrap" }}>
              {["HIPAA", "FHIR R4", "HL7 v2", "BAA SIGNED", "SOC 2", "AES-256", "MFA ENFORCED"].map(b => (
                <span key={b} style={{
                  border: "1px solid rgba(14,165,233,0.3)",
                  borderRadius: 3,
                  padding: "3px 10px",
                  fontSize: 10,
                  letterSpacing: 2,
                  color: "#0EA5E9",
                  background: "rgba(14,165,233,0.06)",
                }}>{b}</span>
              ))}
            </div>

            {/* Layers */}
            {layers.map((layer, li) => (
              <div key={layer.id} style={{ marginBottom: 6 }}>
                {/* Layer label */}
                <div style={{
                  fontSize: 10, letterSpacing: 4, color: layer.color,
                  marginBottom: 6, paddingLeft: 4,
                  borderLeft: `2px solid ${layer.color}`,
                  paddingTop: 2, paddingBottom: 2,
                }}>
                  {layer.label}
                </div>

                {/* Nodes row */}
                <div style={{
                  display: "grid",
                  gridTemplateColumns: "repeat(4, 1fr)",
                  gap: 8,
                  background: `rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.04)`,
                  border: `1px solid rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.15)`,
                  borderRadius: 6,
                  padding: 12,
                }}>
                  {layer.nodes.map(node => (
                    <button
                      key={node.id}
                      onClick={() => setActive(active === node.id ? null : node.id)}
                      style={{
                        background: active === node.id
                          ? `rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.2)`
                          : "rgba(255,255,255,0.03)",
                        border: `1px solid ${active === node.id ? layer.color : "rgba(255,255,255,0.08)"}`,
                        borderRadius: 6,
                        padding: "12px 10px",
                        cursor: "pointer",
                        textAlign: "left",
                        transition: "all 0.15s ease",
                        boxShadow: active === node.id ? `0 0 16px ${layer.glow}` : "none",
                        color: "#E2E8F0",
                        width: "100%", /* fixed to ensure grid layout */
                      }}
                      onMouseEnter={e => {
                        if (active !== node.id) {
                          e.currentTarget.style.borderColor = layer.color;
                          e.currentTarget.style.background = `rgba(${layer.color === "#0EA5E9" ? "14,165,233" : layer.color === "#F59E0B" ? "245,158,11" : layer.color === "#8B5CF6" ? "139,92,246" : layer.color === "#10B981" ? "16,185,129" : layer.color === "#EF4444" ? "239,68,68" : "236,72,153"},0.08)`;
                        }
                      }}
                      onMouseLeave={e => {
                        if (active !== node.id) {
                          e.currentTarget.style.borderColor = "rgba(255,255,255,0.08)";
                          e.currentTarget.style.background = "rgba(255,255,255,0.03)";
                        }
                      }}
                    >
                      <div style={{ fontSize: 20, marginBottom: 5 }}>{node.icon}</div>
                      <div style={{ fontSize: 11, fontWeight: 700, color: layer.color, letterSpacing: 0.5, marginBottom: 3 }}>
                        {node.label}
                      </div>
                      <div style={{ fontSize: 9.5, color: "#64748B", letterSpacing: 0.3, lineHeight: 1.4 }}>
                        {node.sub}
                      </div>
                    </button>
                  ))}
                </div>

                {/* Connector arrow */}
                {li < layers.length - 1 && (
                  <div style={{ textAlign: "center", padding: "4px 0", color: "#1E3A5F", fontSize: 16 }}>
                    ‚ñº
                  </div>
                )}
              </div>
            ))}

            {/* Detail panel */}
            {detail && (
              <div style={{
                marginTop: 24,
                background: "rgba(14,165,233,0.06)",
                border: "1px solid rgba(14,165,233,0.3)",
                borderRadius: 8,
                padding: "20px 24px",
                animation: "fadeIn 0.2s ease",
              }}>
                <style>{`@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }`}</style>
                <div style={{ fontSize: 10, letterSpacing: 4, color: "#0EA5E9", marginBottom: 6 }}>COMPONENT DETAIL</div>
                <div style={{ fontSize: 15, fontWeight: 700, color: "#E2E8F0", marginBottom: 8 }}>{detail.title}</div>
                <div style={{ fontSize: 12.5, color: "#94A3B8", lineHeight: 1.7 }}>{detail.desc}</div>
              </div>
            )}

            {/* Data flow legend */}
            <div style={{
              marginTop: 28,
              display: "grid",
              gridTemplateColumns: "repeat(3, 1fr)",
              gap: 12,
            }}>
              {[
                { icon: "üîí", label: "All PHI encrypted at rest (AES-256) and in transit (TLS 1.3)" },
                { icon: "üìù", label: "Every AI output is a DRAFT until physician-signed. Status: draft ‚Üí reviewed ‚Üí signed" },
                { icon: "üö´", label: "No hard deletes. All records use soft-delete with deleted_at timestamps" },
              ].map((item, i) => (
                <div key={i} style={{
                  background: "rgba(255,255,255,0.02)",
                  border: "1px solid rgba(255,255,255,0.06)",
                  borderRadius: 6,
                  padding: "12px 14px",
                  display: "flex",
                  gap: 10,
                  alignItems: "flex-start",
                }}>
                  <span style={{ fontSize: 16, flexShrink: 0 }}>{item.icon}</span>
                  <span style={{ fontSize: 10.5, color: "#64748B", lineHeight: 1.5 }}>{item.label}</span>
                </div>
              ))}
            </div>

            {/* Footer */}
            <div style={{ textAlign: "center", marginTop: 28, fontSize: 10, color: "#1E3A5F", letterSpacing: 3 }}>
              MINDBRIDGE HEALTH AI ¬∑ WEEK 2 ¬∑ FIDELIS EMMANUEL ¬∑ HEALTHCARE AI ENGINEER IN TRAINING
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ArchDiagram />);
</script>

</body>
</html>
